 // 爆裂ブロック JavaScript版 ver0.03
 // https://bakuretuken.com/block/
if(typeof BLOCK_GAME_MIN_BLOCK_PIXEL=='undefined'){if(BLOCK_GAME_BLOCK_SIZE==0x20)var BLOCK_GAME_MIN_BLOCK_PIXEL=0x18;else var BLOCK_GAME_MIN_BLOCK_PIXEL=0x6;}BLOCK_GAME_WIDTH%BLOCK_GAME_BLOCK_SIZE!=0x0&&alert('BLOCK_GAME_WIDTH\x20is\x20not\x20a\x20multiple\x20of\x20BLOCK_GAME_BLOCK_SIZE');BLOCK_GAME_HEIGHT%BLOCK_GAME_BLOCK_SIZE!=0x0&&alert('BLOCK_GAME_HEIGHT\x20is\x20not\x20a\x20multiple\x20of\x20BLOCK_GAME_BLOCK_SIZE');enchant();var game=new Game(BLOCK_GAME_WIDTH,BLOCK_GAME_HEIGHT);game['preload']('block_image_front.png','block_image_back.jpg','block_image_win.jpg','block_icon_menu.png','block_icon_boll.png','block_icon_panel.png'),game['fps']=BLOCK_GAME_FPS,game['mode']=0x0,game['lifeLabel']=new Label();var scene=new Scene(),imgFront=new Image(),imgBack=new Image(),imgWin=new Image(),sf=new Surface(BLOCK_GAME_WIDTH,BLOCK_GAME_HEIGHT),touchPos=-0x1,blockBaseNum=0x0,blockBaseNumMaster=0x0,blockBase=new Array(BLOCK_GAME_WIDTH/BLOCK_GAME_BLOCK_SIZE);for(k=0x0;k<blockBase['length'];k++)blockBase[k]=new Array(BLOCK_GAME_HEIGHT/BLOCK_GAME_BLOCK_SIZE);var blockBaseMaster=new Array(BLOCK_GAME_WIDTH/BLOCK_GAME_BLOCK_SIZE);for(k=0x0;k<blockBaseMaster['length'];k++)blockBaseMaster[k]=new Array(BLOCK_GAME_HEIGHT/BLOCK_GAME_BLOCK_SIZE);StartLabelSprite=Class['create'](Sprite,{'initialize':function(){Sprite['call'](this,0x200,0x80),this['image']=game['assets']['block_icon_menu.png'],this['init']();},'init':function(){this['frame']=0x0,this['x']=BLOCK_GAME_WIDTH/0x2-this['width']/0x2,this['y']=BLOCK_GAME_HEIGHT/0x2-this['height']/0x2;},'ontouchstart':function(_0x1dfe34){if(game['mode']==0x0)gameStart();if(game['mode']==0x9||game['mode']==0xa)gameRestart();}}),SpriteScreen=Class['create'](Sprite,{'initialize':function(){Sprite['call'](this,BLOCK_GAME_WIDTH,BLOCK_GAME_HEIGHT);},'ontouchstart':function(_0x22a51d){touchPos=_0x22a51d['x'];},'ontouchend':function(_0xbdb913){touchPos=-0x1;},'ontouchmove':function(_0x35dc8a){if(touchPos==-0x1)return;var _0x42f7b1=_0x35dc8a['x']-touchPos;touchPos=_0x35dc8a['x'],game['bar']['x']=game['bar']['x']+_0x42f7b1;if(game['bar']['x']<0x0)game['bar']['x']=0x0;if(game['bar']['x']>BLOCK_GAME_WIDTH-0x78)game['bar']['x']=BLOCK_GAME_WIDTH-0x78;game['mode']==0x0&&(game['bomb']['ox']=game['bar']['x']+0x78/0x2,game['bomb']['x']=game['bomb']['ox']-0xa);}}),Bomb=Class['create'](Sprite,{'initialize':function(){Sprite['call'](this,0x16,0x16),this['image']=game['assets']['block_icon_boll.png'],this['init']();},'init':function(){this['frame']=0x0,this['ox']=0x78/0x2+0xa,this['oy']=BLOCK_GAME_HEIGHT-BLOCK_BAR_MARGIN_BOTTOM-0x14,this['x']=this['ox']-0xa,this['y']=this['oy']-0xa,this['vy']=0x0,this['vx']=0x0;},'onenterframe':function(){if(game['mode']!=0x1)return;this['move']()&&(this['ox']=this['ox']+this['vx'],this['oy']=this['oy']+this['vy'],this['x']=this['ox']-0xa,this['y']=this['oy']-0xa);},'move':function(){var _0x272b1c=!![];if(game['bar']['time']>0x0)game['bar']['time']--;if(game['bar']['time']==0x0)game['bar']['frame']=0x0;this['ox']<0xa&&(this['ox']=0xa,this['vx']=-this['vx'],_0x272b1c=![]);this['ox']>BLOCK_GAME_WIDTH-0xa&&(this['ox']=BLOCK_GAME_WIDTH-0xa,this['vx']=-this['vx'],_0x272b1c=![]);this['oy']<0xa&&(this['oy']=0xa,this['vy']=-this['vy'],_0x272b1c=![]);if(this['intersect'](game['bar'])){this['vy']=-this['vy'],game['bomb']['frame']=0x0,game['bar']['frame']=0x1,game['bar']['time']=0x3,this['oy']=BLOCK_GAME_HEIGHT-BLOCK_BAR_MARGIN_BOTTOM-0xc;if(this['ox']<game['bar']['x']+0x1e)this['vx']=-Math['abs'](BLOCK_GAME_BALL_SPEED+0x3),this['vy']=-Math['abs'](BLOCK_GAME_BALL_SPEED-0x3);else{if(this['ox']>game['bar']['x']+0x5a)this['vx']=Math['abs'](BLOCK_GAME_BALL_SPEED+0x3),this['vy']=-Math['abs'](BLOCK_GAME_BALL_SPEED-0x3);else this['ox']>=game['bar']['x']+0x3a&&this['ox']<=game['bar']['x']+0x3e?(game['bomb']['frame']=0x1,this['vx']=this['vx']>0x0?BLOCK_GAME_BALL_SPEED:-BLOCK_GAME_BALL_SPEED,this['vy']=-BLOCK_GAME_BALL_SPEED):(this['vx']=this['vx']>0x0?BLOCK_GAME_BALL_SPEED:-BLOCK_GAME_BALL_SPEED,this['vy']=-BLOCK_GAME_BALL_SPEED);}}if(this['oy']>BLOCK_GAME_HEIGHT-0xa)return gameLose(),![];if(parseInt((this['ox']+this['vx'])/BLOCK_GAME_BLOCK_SIZE)>=BLOCK_GAME_WIDTH/BLOCK_GAME_BLOCK_SIZE)return!![];var _0x18c965=parseInt((this['ox']+this['vx'])/BLOCK_GAME_BLOCK_SIZE),_0x17d3e7=parseInt(this['oy']/BLOCK_GAME_BLOCK_SIZE);if(blockBase[_0x18c965][_0x17d3e7]){blockBase[_0x18c965][_0x17d3e7]=![],blockBaseNum--,drawBackImage(_0x18c965,_0x17d3e7);if(blockBaseNum==0x0)return gameWin(),![];game['bomb']['frame']==0x0&&(this['vx']=-this['vx'],_0x272b1c=![]);}if(parseInt((this['oy']+this['vy'])/BLOCK_GAME_BLOCK_SIZE)>=BLOCK_GAME_HEIGHT/BLOCK_GAME_BLOCK_SIZE)return!![];var _0x18c965=parseInt(this['ox']/BLOCK_GAME_BLOCK_SIZE),_0x17d3e7=parseInt((this['oy']+this['vy'])/BLOCK_GAME_BLOCK_SIZE);if(blockBase[_0x18c965][_0x17d3e7]){blockBase[_0x18c965][_0x17d3e7]=![],blockBaseNum--,drawBackImage(_0x18c965,_0x17d3e7);if(blockBaseNum==0x0)return gameWin(),![];game['bomb']['frame']==0x0&&(this['vy']=-this['vy'],_0x272b1c=![]);}return _0x272b1c;}}),PanelBar=Class['create'](Sprite,{'initialize':function(){Sprite['call'](this,0x78,0x10),this['image']=game['assets']['block_icon_panel.png'],this['init']();},'init':function(){this['x']=0xa,this['y']=BLOCK_GAME_HEIGHT-BLOCK_BAR_MARGIN_BOTTOM,this['time']=0x0;}}),window['onload']=function(){game['onload']=function(){imgFront=game['assets']['block_image_front.png']['_element'],imgBack=game['assets']['block_image_back.jpg']['_element'],imgWin=game['assets']['block_image_win.jpg']['_element'],game['restart']=new StartLabelSprite(),game['bomb']=new Bomb(),game['bar']=new PanelBar(),game['spriteScreen']=new SpriteScreen(),document['getElementById']('enchant-stage')['addEventListener']('mousemove',function(_0x49325b){var _0x10f963=_0x49325b['pageX']-this['getBoundingClientRect']()['left']-game['bar']['width']/0x2;game['bar']['x']=_0x49325b['pageX']-this['getBoundingClientRect']()['left']-game['bar']['width']/0x2;if(game['bar']['x']<0x0)game['bar']['x']=0x0;if(game['bar']['x']>BLOCK_GAME_WIDTH-0x78)game['bar']['x']=BLOCK_GAME_WIDTH-0x78;game['mode']==0x0&&(game['bomb']['ox']=game['bar']['x']+0x78/0x2,game['bomb']['x']=game['bomb']['ox']-0xa);},![]),document['getElementById']('enchant-stage')['addEventListener']('click',function(_0x41169a){if(_0x41169a['pageY']<0x96)return;if(game['mode']==0x0)gameStart();if(game['mode']==0x9)gameRestart();},![]),initGame(),game['spriteScreen']['image']=sf,scene['addChild'](game['spriteScreen']),scene['addChild'](game['restart']),scene['addChild'](game['bar']),scene['addChild'](game['bomb']),game['replaceScene'](scene);},game['start']();};function initGame(){sf['context']['drawImage'](imgFront,0x0,0x0),blockBaseNum=0x0,blockBaseNumMaster=0x0;for(y=0x0;y<BLOCK_GAME_HEIGHT/BLOCK_GAME_BLOCK_SIZE;y++){for(x=0x0;x<BLOCK_GAME_WIDTH/BLOCK_GAME_BLOCK_SIZE;x++){blockBase[x][y]=![],blockBaseMaster[x][y]=![],haveBlock(sf['context'],x,y)&&(blockBase[x][y]=!![],blockBaseMaster[x][y]=!![],blockBaseNum++,blockBaseNumMaster++);}}sf['context']['drawImage'](imgBack,0x0,0x0),sf['context']['drawImage'](imgFront,0x0,0x0);};function haveBlock(_0x28cda9,_0x50f9dc,_0x4bcd39){var _0xfbb86d=0x0,_0x472747=0x0,_0x74d507=_0x28cda9['getImageData'](_0x50f9dc*BLOCK_GAME_BLOCK_SIZE,_0x4bcd39*BLOCK_GAME_BLOCK_SIZE,BLOCK_GAME_BLOCK_SIZE,BLOCK_GAME_BLOCK_SIZE);for(_0x472747=0x0;_0x472747<BLOCK_GAME_BLOCK_SIZE*BLOCK_GAME_BLOCK_SIZE;_0x472747++){if(_0x74d507['data'][_0x472747*0x4+0x3])_0xfbb86d++;}return _0xfbb86d>=BLOCK_GAME_MIN_BLOCK_PIXEL?!![]:![];};function drawBackImage(_0x3feae8,_0x3dcdca){sf['context']['drawImage'](imgBack,_0x3feae8*BLOCK_GAME_BLOCK_SIZE,_0x3dcdca*BLOCK_GAME_BLOCK_SIZE,BLOCK_GAME_BLOCK_SIZE,BLOCK_GAME_BLOCK_SIZE,_0x3feae8*BLOCK_GAME_BLOCK_SIZE,_0x3dcdca*BLOCK_GAME_BLOCK_SIZE,BLOCK_GAME_BLOCK_SIZE,BLOCK_GAME_BLOCK_SIZE);};function gameStart(){game['restart']['y']=-0x64,game['bomb']['vy']=BLOCK_GAME_BALL_SPEED,game['bomb']['vx']=BLOCK_GAME_BALL_SPEED,game['mode']=0x1;};function gameLose(){game['restart']['x']=BLOCK_GAME_WIDTH/0x2-game['restart']['width']/0x2,game['restart']['y']=BLOCK_GAME_HEIGHT/0x2-game['restart']['height']/0x2-0x32,game['restart']['frame']=0x1,game['bomb']['vy']=0x0,game['bomb']['vx']=0x0,game['bomb']['oy']=-0x64,game['bomb']['y']=-0x64,game['mode']=0x9;};function gameWin(){game['mode']=0xa,game['bomb']['vy']=0x0,game['bomb']['vx']=0x0,game['bomb']['oy']=-0x64,game['bomb']['y']=-0x64,game['bar']['y']=-0x64,sf['context']['drawImage'](imgWin,0x0,0x0);};function gameRestart(){blockBaseNum=blockBaseNumMaster;for(y=0x0;y<BLOCK_GAME_HEIGHT/BLOCK_GAME_BLOCK_SIZE;y++){for(x=0x0;x<BLOCK_GAME_WIDTH/BLOCK_GAME_BLOCK_SIZE;x++){blockBase[x][y]=blockBaseMaster[x][y];}}sf['context']['drawImage'](imgBack,0x0,0x0),sf['context']['drawImage'](imgFront,0x0,0x0),game['restart']['init'](),game['bomb']['init'](),game['bar']['init'](),game['mode']=0x0;};
